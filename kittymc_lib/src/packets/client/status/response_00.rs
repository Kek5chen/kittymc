use crate::error::KittyMCError;
use crate::packets::packet_serialization::{
    read_length_prefixed_string, write_length_prefixed_string, SerializablePacket,
};
use crate::packets::{wrap_packet, Packet};
use kittymc_macros::Packet;
use serde::{Deserialize, Serialize};
use std::fmt::{Debug, Formatter};
use std::str::FromStr;
use uuid::Uuid;

const DEFAULT_IMAGE_DATA: &str = "data:image/png;base64,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";

#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]
pub struct StatusResponseVersion {
    name: String,
    protocol: u32,
}

#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]
pub struct StatusResponsePlayer {
    name: String,
    id: Uuid,
}

#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]
pub struct StatusResponsePlayers {
    max: u32,
    online: u32,
    sample: Vec<StatusResponsePlayer>,
}

#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]
pub struct StatusResponseText {
    text: String,
}

#[derive(Serialize, Deserialize, Clone, PartialEq, Packet)]
pub struct StatusResponsePacket {
    version: StatusResponseVersion,
    players: StatusResponsePlayers,
    description: StatusResponseText,
    favicon: String,
    #[serde(rename = "enforcesSecureChat")]
    enforces_secure_chat: bool,
}

impl Debug for StatusResponsePacket {
    fn fmt(&self, f: &mut Formatter<'_>) -> std::fmt::Result {
        f.debug_struct("StatusResponsePacket")
            .field("version", &self.version)
            .field("players", &self.players)
            .field("description", &self.description)
            .field("favicon", &"...")
            .field("enforces_secure_chat", &self.enforces_secure_chat)
            .finish()
    }
}

impl Default for StatusResponsePacket {
    fn default() -> Self {
        StatusResponsePacket {
            version: StatusResponseVersion {
                name: "KittyMC".to_string(),
                protocol: 340, // TODO: Replace this with global versioned consts
            },
            players: StatusResponsePlayers {
                max: 69,
                online: 55,
                sample: vec![StatusResponsePlayer {
                    name: "will_owo".to_string(),
                    id: Uuid::from_str("6eab089f-9698-47fb-8fe5-c95fb5d20b6c").unwrap(),
                }],
            },
            description: StatusResponseText {
                text: "§4K§6I§eT§aT§bY §dMC §5!!!!! §d[ totally wow ]\n§d~ xXx mew mew xXx ~"
                    .to_string(),
            },
            favicon: DEFAULT_IMAGE_DATA.to_string(),
            enforces_secure_chat: false,
        }
    }
}

impl SerializablePacket for StatusResponsePacket {
    fn serialize(&self) -> Vec<u8> {
        let mut packet = vec![];
        let json_response = serde_json::to_string(self).unwrap_or_else(|_| "".to_string());

        write_length_prefixed_string(&mut packet, json_response.as_str());

        wrap_packet(&mut packet, Self::id());

        packet
    }

    fn deserialize(mut data: &[u8]) -> Result<(usize, Packet), KittyMCError> {
        let mut size = 0;

        let string = read_length_prefixed_string(&mut data, &mut size)?;

        let response = serde_json::from_str::<StatusResponsePacket>(string.as_str())?;

        Ok((size, Packet::StatusResponse(response)))
    }

    fn id() -> u32 {
        0
    }
}
